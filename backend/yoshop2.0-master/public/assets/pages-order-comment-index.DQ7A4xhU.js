import{$ as e,c as s,w as a,n as o,e as t,i as l,o as c,a as i,b as d,d as n,F as r,k as m,f as g,t as u,g as f,l as h,a4 as _}from"./index-BR_epvkd.js";import{i as p}from"./upload.g1lSbLaT.js";import{_ as L}from"./_plugin-vue_export-helper.BCo6x5W8.js";const D="order.comment/list",b="order.comment/submit";const k=L({data:()=>({isLoading:!0,orderId:null,goodsList:[],formData:[],maxImageLength:6,disabled:!1}),onLoad({orderId:e}){this.orderId=e,this.getGoodsList()},methods:{getGoodsList(){const s=this;var a,o;s.isLoading=!0,(a=s.orderId,e.get(D,{orderId:a,...o})).then((e=>{s.goodsList=e.data.goodsList,s.initFormData(),s.isLoading=!1}))},initFormData(){const{goodsList:e}=this,s=e.map((e=>({goods_id:e.goods_id,order_goods_id:e.order_goods_id,score:10,content:"",imageList:[],uploaded:[]})));this.formData=s},setScore(e,s){this.formData[e].score=s},chooseImage(e){const s=this,a=s.formData[e].imageList;uni.chooseImage({count:6-a.length,sizeType:["original","compressed"],sourceType:["album","camera"],success({tempFiles:o}){s.formData[e].imageList=a.concat(o)}})},deleteImage(e,s){this.formData[e].imageList.splice(s,1)},handleSubmit(){const e=this;if(!0===e.disabled)return!1;e.disabled=!0;e.getImagesLength()>0?e.uploadFile().then((()=>{console.log("then"),e.onSubmit()})).catch((s=>{console.log("catch"),e.disabled=!1,0!==s.statusCode&&e.$toast(s.errMsg),console.log("err",s)})):e.onSubmit()},getImagesLength(){const{formData:e}=this;let s=0;return e.forEach((e=>{e.content.trim()&&(s+=e.imageList.length)})),s},onSubmit(){const s=this;var a,o;(a=s.orderId,o=s.formData,e.post(b,{orderId:a,form:o})).then((e=>{s.$toast(e.message),setTimeout((()=>{s.disabled=!1,uni.navigateBack()}),1500)})).catch((e=>s.disabled=!1))},uploadFile(){const e=this,{formData:s}=e,a=[];return s.forEach(((e,s)=>{if(e.content.trim()&&e.imageList.length){const o=e.imageList.map((e=>e));a.push({formDataIndex:s,images:o})}})),new Promise(((s,o)=>{Promise.all(a.map(((s,a)=>new Promise(((o,t)=>{p(s.images).then((s=>{e.formData[a].uploaded=s,o(s)})).catch(t)}))))).then(s,o)}))}}},[["render",function(e,p,L,D,b,k){const I=f,x=l,v=h,C=_;return b.isLoading?t("",!0):(c(),s(x,{key:0,class:"container",style:o(e.appThemeStyle)},{default:a((()=>[i(x,{class:"goods-list"},{default:a((()=>[(c(!0),d(r,null,n(b.goodsList,((e,o)=>(c(),s(x,{class:"goods-item",key:o},{default:a((()=>[i(x,{class:"goods-main"},{default:a((()=>[i(x,{class:"goods-image"},{default:a((()=>[i(I,{class:"image",src:e.goods_image,mode:"scaleToFill"},null,8,["src"])])),_:2},1024),i(x,{class:"goods-content"},{default:a((()=>[i(x,{class:"goods-title"},{default:a((()=>[i(v,{class:"twoline-hide"},{default:a((()=>[g(u(e.goods_name),1)])),_:2},1024)])),_:2},1024),i(x,{class:"goods-props clearfix"},{default:a((()=>[(c(!0),d(r,null,n(e.goods_props,((e,o)=>(c(),s(x,{class:"goods-props-item",key:o},{default:a((()=>[i(v,null,{default:a((()=>[g(u(e.value.name),1)])),_:2},1024)])),_:2},1024)))),128))])),_:2},1024)])),_:2},1024),i(x,{class:"goods-trade"},{default:a((()=>[i(x,{class:"goods-price"},{default:a((()=>[i(v,{class:"unit"},{default:a((()=>[g("￥")])),_:1}),i(v,{class:"value"},{default:a((()=>[g(u(e.goods_price),1)])),_:2},1024)])),_:2},1024),i(x,{class:"goods-num"},{default:a((()=>[i(v,null,{default:a((()=>[g("×"+u(e.total_num),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024),i(x,{class:"score-row"},{default:a((()=>[i(x,{class:m(["score-item score-praise",{active:10==b.formData[o].score}]),onClick:e=>k.setScore(o,10)},{default:a((()=>[i(x,{class:"score"},{default:a((()=>[i(v,{class:"score-icon iconfont icon-haoping"}),i(v,{class:"score-text"},{default:a((()=>[g("好评")])),_:1})])),_:1})])),_:2},1032,["class","onClick"]),i(x,{class:m(["score-item score-review",{active:20==b.formData[o].score}]),onClick:e=>k.setScore(o,20)},{default:a((()=>[i(x,{class:"score"},{default:a((()=>[i(v,{class:"score-icon iconfont icon-zhongping"}),i(v,{class:"score-text"},{default:a((()=>[g("中评")])),_:1})])),_:1})])),_:2},1032,["class","onClick"]),i(x,{class:m(["score-item score-negative",{active:30==b.formData[o].score}]),onClick:e=>k.setScore(o,30)},{default:a((()=>[i(x,{class:"score"},{default:a((()=>[i(v,{class:"score-icon iconfont icon-chaping"}),i(v,{class:"score-text"},{default:a((()=>[g("差评")])),_:1})])),_:1})])),_:2},1032,["class","onClick"])])),_:2},1024),i(x,{class:"form-content"},{default:a((()=>[i(C,{class:"textarea",modelValue:b.formData[o].content,"onUpdate:modelValue":e=>b.formData[o].content=e,maxlength:"500",placeholder:"请输入评价内容 (留空则不评价)"},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024),i(x,{class:"image-list"},{default:a((()=>[(c(!0),d(r,null,n(b.formData[o].imageList,((e,t)=>(c(),s(x,{class:"image-preview",key:t},{default:a((()=>[i(v,{class:"image-delete iconfont icon-shanchu",onClick:e=>k.deleteImage(o,t)},null,8,["onClick"]),i(I,{class:"image",mode:"aspectFill",src:e.path},null,8,["src"])])),_:2},1024)))),128)),!b.formData[o].imageList||b.formData[o].imageList.length<b.maxImageLength?(c(),s(x,{key:0,class:"image-picker",onClick:e=>k.chooseImage(o)},{default:a((()=>[i(v,{class:"choose-icon iconfont icon-camera"}),i(v,{class:"choose-text"},{default:a((()=>[g("上传图片")])),_:1})])),_:2},1032,["onClick"])):t("",!0)])),_:2},1024)])),_:2},1024)))),128))])),_:1}),i(x,{class:"footer-fixed"},{default:a((()=>[i(x,{class:"btn-wrapper"},{default:a((()=>[i(x,{class:m(["btn-item btn-item-main",{disabled:b.disabled}]),onClick:p[0]||(p[0]=e=>k.handleSubmit())},{default:a((()=>[g("确认提交")])),_:1},8,["class"])])),_:1})])),_:1})])),_:1},8,["style"]))}],["__scopeId","data-v-94a3912d"]]);export{k as default};
