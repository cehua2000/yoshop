import{$ as e,Q as a,B as t,q as l,c as s,w as n,n as o,e as i,a0 as u,i as c,o as d,a as r,f as m,t as h,b as p,d as f,F as y,l as _,I as g,R as P,a5 as b,k as S}from"./index-BR_epvkd.js";import{_ as I}from"./u-modal.qg4fzymA.js";import{r as T}from"./uni-app.es.Cu0rwAi-.js";import{P as C}from"./Client.Dtcsx8M3.js";import{e as v,a as x,p as w,b as A}from"./wechat.BP1y4zLg.js";import{_ as k}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./u-loading.BOZG1sHe.js";import"./u-popup.DYU41LT0.js";import"./u-icon.DIMPaE6q.js";const D="recharge/center",M="recharge/submit",E="recharge/tradeQuery";const V={[C.WECHAT.value]:"icon-wechat-pay",[C.ALIPAY.value]:"icon-alipay"},L={[C.WECHAT.value]:"微信",[C.ALIPAY.value]:"支付宝"};const U=k({data:()=>({isLoading:!0,disabled:!1,PayMethodEnum:C,PayMethodIconEnum:V,PayMethodClientNameEnum:L,personal:{balance:"0.00"},setting:{},planList:[],methods:[],selectedPlanId:0,inputValue:"",curPaymentItem:null,showConfirmModal:!1,tempUnifyData:{outTradeNo:"",method:""}}),onShow(){this.getPageData()},methods:{onSelectPlan(e){this.selectedPlanId=e,this.inputValue=""},onChangeMoney({detail:e}){this.inputValue=e.value,this.selectedPlanId=0},handleSelectPayType(e){this.curPaymentItem=this.methods[e]},getPageData(){const a=this;return a.isLoading=!0,new Promise(((t,l)=>{var s;(s={client:a.platform},e.get(D,s)).then((e=>{a.setting=e.data.setting,a.personal=e.data.personal,a.planList=e.data.planList,a.methods=e.data.paymentMethods,a.isLoading=!1,a.setDefaultPayType(),this.performance()}))}))},setDefaultPayType(){this.curPaymentItem||this.handleSelectPayType(0)},performance(){const e=this,a=(e=>{const a=u.get("tempUnifyData_"+e);return a?(u.remove("tempUnifyData_"+e),a):null})("recharge");a&&(e.tempUnifyData=a,e.showConfirmModal=!0)},onSubmit(a){const t=this;var l;t.curPaymentItem?t.disabled||(t.disabled=!0,(l={planId:t.selectedPlanId,customMoney:t.inputValue?t.inputValue:"",method:t.curPaymentItem.method,client:t.platform,extra:t.getExtraAsUnify(t.curPaymentItem.method)},e.post(M,{form:l})).then((e=>t.onSubmitCallback(e))).finally((e=>{setTimeout((()=>t.disabled=!1),10)}))):t.$toast("您还没有选择支付方式")},getExtraAsUnify:e=>e===C.ALIPAY.value?v():e===C.WECHAT.value?x():{},onSubmitCallback(e){const a=this,t=a.curPaymentItem.method,l=e.data.payment;t===C.BALANCE.value&&a.onShowSuccess(e),t===C.ALIPAY.value&&(console.log("paymentData",l),w({orderKey:"recharge",...l}).then((e=>a.onPaySuccess(e))).catch((e=>a.onPayFail(e)))),t===C.WECHAT.value&&(console.log("paymentData",l),A({orderKey:"recharge",...l}).then((e=>a.onPaySuccess(e))).catch((e=>a.onPayFail(e))))},onPaySuccess({res:e,option:{isRequireQuery:a,outTradeNo:t,method:l}}){if(a)return this.onTradeQuery(t,l),!0;this.onShowSuccess(e)},onShowSuccess({message:e}){this.$toast(e||"订单支付成功"),this.onSuccessNav()},onPayFail(e){console.log("onPayFail",e);const a=e.message||"订单未支付";this.$error(a)},onTradeQuery(a,t){const l=this;var s;(s={outTradeNo:a,method:t,client:l.platform},e.get(E,s)).then((e=>e.data.isPay?l.onShowSuccess(e):l.onPayFail(e))).finally((()=>l.showConfirmModal=!1))},onSuccessNav(){const e=a(),l=e.length<2?null:e[e.length-2];l&&t(l.route,["pages/wallet/index"])?setTimeout((()=>uni.navigateBack()),1e3):setTimeout((()=>{this.$navTo("pages/wallet/index",{},"redirectTo")}),1200)}}},[["render",function(e,a,t,u,C,v){const x=_,w=c,A=g,k=P,D=b,M=T(l("u-modal"),I);return C.personal.user_id?(d(),s(w,{key:0,class:"container",style:o(e.appThemeStyle)},{default:n((()=>[r(w,{class:"account-panel dis-flex flex-y-center"},{default:n((()=>[r(w,{class:"panel-lable"},{default:n((()=>[r(x,null,{default:n((()=>[m("账户余额")])),_:1})])),_:1}),r(w,{class:"panel-balance flex-box"},{default:n((()=>[r(x,null,{default:n((()=>[m("￥"+h(C.personal.balance),1)])),_:1})])),_:1})])),_:1}),r(w,{class:"recharge-panel"},{default:n((()=>[r(w,{class:"recharge-label"},{default:n((()=>[r(x,null,{default:n((()=>[m("充值金额")])),_:1})])),_:1}),r(w,{class:"recharge-plan clearfix"},{default:n((()=>[(d(!0),p(y,null,f(C.planList,((e,a)=>(d(),s(w,{key:a,class:S(["recharge-plan_item",{active:C.selectedPlanId==e.plan_id}]),onClick:a=>v.onSelectPlan(e.plan_id)},{default:n((()=>[r(w,{class:"plan_money"},{default:n((()=>[r(x,null,{default:n((()=>[m(h(e.money),1)])),_:2},1024)])),_:2},1024),r(w,{class:"plan_gift"},{default:n((()=>[r(x,null,{default:n((()=>[m("送"+h(e.gift_money),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1}),1==C.setting.is_custom?(d(),s(w,{key:0,class:"recharge-input"},{default:n((()=>[r(A,{class:"input",type:"digit",placeholder:"可输入自定义充值金额",modelValue:C.inputValue,"onUpdate:modelValue":a[0]||(a[0]=e=>C.inputValue=e),onInput:v.onChangeMoney},null,8,["modelValue","onInput"])])),_:1})):i("",!0),r(w,{class:"recharge-label m-top60"},{default:n((()=>[r(x,null,{default:n((()=>[m("支付方式")])),_:1})])),_:1}),r(w,{class:"payment-method"},{default:n((()=>[(d(!0),p(y,null,f(C.methods,((e,a)=>(d(),s(w,{key:a,class:"pay-item dis-flex flex-x-between",onClick:e=>v.handleSelectPayType(a)},{default:n((()=>[r(w,{class:"item-left dis-flex flex-y-center"},{default:n((()=>[r(w,{class:S(["item-left_icon",[e.method]])},{default:n((()=>[r(x,{class:S(["iconfont",[C.PayMethodIconEnum[e.method]]])},null,8,["class"])])),_:2},1032,["class"]),r(w,{class:"item-left_text"},{default:n((()=>[r(x,null,{default:n((()=>[m(h(C.PayMethodEnum[e.method].name),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),C.curPaymentItem&&C.curPaymentItem.method==e.method?(d(),s(w,{key:0,class:"item-right col-m"},{default:n((()=>[r(x,{class:"iconfont icon-check"})])),_:1})):i("",!0)])),_:2},1032,["onClick"])))),128))])),_:1}),r(w,{class:"recharge-submit btn-submit"},{default:n((()=>[r(D,{onSubmit:v.onSubmit},{default:n((()=>[r(k,{class:"button",formType:"submit",disabled:C.disabled},{default:n((()=>[m("立即充值")])),_:1},8,["disabled"])])),_:1},8,["onSubmit"])])),_:1})])),_:1}),r(w,{class:"describe-panel"},{default:n((()=>[r(w,{class:"recharge-label"},{default:n((()=>[r(x,null,{default:n((()=>[m("充值说明")])),_:1})])),_:1}),r(w,{class:"content"},{default:n((()=>[r(x,{space:"ensp"},{default:n((()=>[m(h(C.setting.describe),1)])),_:1})])),_:1})])),_:1}),C.tempUnifyData?(d(),s(M,{key:0,modelValue:C.showConfirmModal,"onUpdate:modelValue":a[1]||(a[1]=e=>C.showConfirmModal=e),title:"支付确认","show-cancel-button":"","confirm-text":"已完成支付","confirm-color":e.appTheme.mainBg,"negative-top":"100",asyncClose:!0,onConfirm:a[2]||(a[2]=e=>v.onTradeQuery(C.tempUnifyData.outTradeNo,C.tempUnifyData.method))},{default:n((()=>[r(w,{class:"modal-content"},{default:n((()=>[r(x,null,{default:n((()=>[m("请在"+h(C.PayMethodClientNameEnum[C.tempUnifyData.method])+"内完成支付，如果您已经支付成功，请点击“已完成支付”按钮",1)])),_:1})])),_:1})])),_:1},8,["modelValue","confirm-color"])):i("",!0)])),_:1},8,["style"])):i("",!0)}],["__scopeId","data-v-92339b85"]]);export{U as default};
