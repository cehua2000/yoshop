import{q as e,o as t,c as o,w as s,a as l,n as a,k as i,i as n,e as d,f as u,t as r,l as c,$ as p,b as f,F as m,d as h,I as _,j as y,h as g,g as C}from"./index-BR_epvkd.js";import{_ as w}from"./u-loading.BOZG1sHe.js";import{r as k}from"./uni-app.es.Cu0rwAi-.js";import{_ as v}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{_ as x}from"./u-modal.qg4fzymA.js";import{_ as b}from"./u-icon.DIMPaE6q.js";import{_ as T}from"./u-popup.DYU41LT0.js";import{C as S}from"./CouponType.DMOMRrRc.js";import{O as P,D as I}from"./OrderType.CT20E9Ho.js";const D=v({name:"u-switch",emits:["update:modelValue","input","change"],props:{value:{type:Boolean,default:!1},modelValue:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},size:{type:[Number,String],default:50},activeColor:{type:String,default:"#2979ff"},inactiveColor:{type:String,default:"#ffffff"},vibrateShort:{type:Boolean,default:!1},activeValue:{type:[Number,String,Boolean],default:!0},inactiveValue:{type:[Number,String,Boolean],default:!1}},data:()=>({}),computed:{valueCom(){return this.modelValue},switchStyle(){let e={};return e.fontSize=this.size+"rpx",e.backgroundColor=this.valueCom?this.activeColor:this.inactiveColor,e},loadingColor(){return this.valueCom?this.activeColor:null}},methods:{onClick(){this.disabled||this.loading||(this.vibrateShort&&uni.vibrateShort(),this.$emit("input",!this.valueCom),this.$emit("update:modelValue",!this.valueCom),this.$nextTick((()=>{this.$emit("change",this.valueCom?this.activeValue:this.inactiveValue)})))}}},[["render",function(d,u,r,c,p,f){const m=k(e("u-loading"),w),h=n;return t(),o(h,{class:i(["u-switch",[1==f.valueCom?"u-switch--on":"",r.disabled?"u-switch--disabled":""]]),onClick:f.onClick,style:a([f.switchStyle])},{default:s((()=>[l(h,{class:"u-switch__node node-class",style:a({width:d.$u.addUnit(r.size),height:d.$u.addUnit(r.size)})},{default:s((()=>[l(m,{show:r.loading,class:"u-switch__loading",size:.6*r.size,color:f.loadingColor},null,8,["show","size","color"])])),_:1},8,["style"])])),_:1},8,["class","onClick","style"])}],["__scopeId","data-v-7debaf62"]]);const E=v({name:"u-toast",props:{zIndex:{type:[Number,String],default:""}},data:()=>({isShow:!1,timer:null,config:{params:{},title:"",type:"",duration:2e3,isTab:!1,url:"",icon:!0,position:"center",callback:null,back:!1},tmpConfig:{}}),computed:{iconName(){if(["error","warning","success","info"].indexOf(this.tmpConfig.type)>=0&&this.tmpConfig.icon){return this.$u.type2icon(this.tmpConfig.type)}},uZIndex(){return this.isShow?this.zIndex?this.zIndex:this.$u.zIndex.toast:"999999"}},methods:{show(e){this.tmpConfig=this.$u.deepMerge(this.config,e),this.timer&&(clearTimeout(this.timer),this.timer=null),this.isShow=!0,this.timer=setTimeout((()=>{this.isShow=!1,clearTimeout(this.timer),this.timer=null,"function"==typeof this.tmpConfig.callback&&this.tmpConfig.callback(),this.timeEnd()}),this.tmpConfig.duration)},hide(){this.isShow=!1,this.timer&&(clearTimeout(this.timer),this.timer=null)},timeEnd(){if(this.tmpConfig.url){if("/"!=this.tmpConfig.url[0]&&(this.tmpConfig.url="/"+this.tmpConfig.url),Object.keys(this.tmpConfig.params).length){let e="";/.*\/.*\?.*=.*/.test(this.tmpConfig.url)?(e=this.$u.queryParams(this.tmpConfig.params,!1),this.tmpConfig.url=this.tmpConfig.url+"&"+e):(e=this.$u.queryParams(this.tmpConfig.params),this.tmpConfig.url+=e)}this.tmpConfig.isTab?uni.switchTab({url:this.tmpConfig.url}):uni.navigateTo({url:this.tmpConfig.url})}else this.tmpConfig.back&&this.$u.route({type:"back"})}}},[["render",function(p,f,m,h,_,y){const g=k(e("u-icon"),b),C=n,w=c;return t(),o(C,{class:i(["u-toast",[_.isShow?"u-show":"","u-type-"+_.tmpConfig.type,"u-position-"+_.tmpConfig.position]]),style:a({zIndex:y.uZIndex})},{default:s((()=>[l(C,{class:"u-icon-wrap"},{default:s((()=>[_.tmpConfig.icon?(t(),o(g,{key:0,class:"u-icon",name:y.iconName,size:30,color:_.tmpConfig.type},null,8,["name","color"])):d("",!0)])),_:1}),l(w,{class:"u-text"},{default:s((()=>[u(r(_.tmpConfig.title),1)])),_:1})])),_:1},8,["class","style"])}],["__scopeId","data-v-aa0b93e8"]]),U="checkout/order",V="checkout/submit",$=Object.freeze(Object.defineProperty({__proto__:null,order:(e,t)=>p.get(U,{mode:e,...t}),submit:(e,t)=>p.post(V,{mode:e,...t},{isPrompt:!1})},Symbol.toStringTag,{value:"Module"})),O=["red","blue","violet","yellow"],z=e=>({buyNow:$,cart:$}[e]),N=(e,t)=>{const o={};return"buyNow"===e&&(o.goodsId=t.goodsId,o.goodsNum=t.goodsNum,o.goodsSkuId=t.goodsSkuId),"cart"===e&&(o.cartIds=t.cartIds),o};const L=v({data:()=>({OrderTypeEnum:P,DeliveryTypeEnum:I,CouponTypeEnum:S,options:{},isShowTab:!1,DeliveryTypeEnum:I,curDelivery:null,CouponColors:O,selectCouponId:0,isUsePoints:!1,remark:"",disabled:!1,showPoints:!1,showPopup:!1,order:{},personal:{},setting:{}}),onLoad(e){this.options=e},onUnload(){},onShow(){this.getOrderData()},methods:{getOrderData(){const e=this,{options:{mode:t}}=e,o=e.getRequestParam();z(t).order(t,o).then((t=>e.initData(t.data))).catch((e=>e))},initData({order:e,setting:t,personal:o}){const s=this;s.order=e,s.personal=o,s.setting=t,e.hasError&&s.showToast(e.errorMsg,3e3),s.curDelivery=e.delivery,s.isShowTab=t.deliveryType.length>1,s.isUsePoints=e.isUsePoints,s.selectCouponId=e.couponId},getRequestParam(){const e=this,{options:t}=e,o=N(t.mode,t);return{...{delivery:e.curDelivery||0,couponId:e.selectCouponId||0,isUsePoints:e.isUsePoints?1:0},...o}},handleSwichDelivery(e){this.curDelivery=e,this.getOrderData()},handleShowPoints(){this.showPoints=!0},handleShowPopup(){this.showPopup=!0},handleDescribe(e){const{couponList:t}=this.order;t[e].expand=!t[e].expand},handleSelectCoupon(e){const t=this,{couponList:o}=t.order,s=o[e];s.is_apply?(t.selectCouponId=t.selectCouponId==s.user_coupon_id?0:s.user_coupon_id,t.getOrderData(),t.showPopup=!1):t.showToast(s.not_apply_info)},handleNotUseCoupon(){this.selectCouponId=0,this.getOrderData(),this.showPopup=!1},onSelectAddress(){this.$navTo("pages/address/index",{from:"checkout"})},onTargetGoods(e){this.$navTo("pages/goods/detail",{goodsId:e})},onSubmitOrder(){const e=this;return!e.disabled&&(!!e.onVerifyFrom()&&(e.disabled=!0,void z(e.options.mode).submit(e.options.mode,e.getFormData()).then((t=>{const o=t.data.orderId;t.data.isPaySuccess?(e.showToast(t.message,1500),setTimeout((()=>e.$navTo("pages/order/index",{},"redirectTo")),1500)):setTimeout((()=>e.$navTo("pages/checkout/cashier/index",{orderId:o},"redirectTo")),100)})).catch((t=>e.showToast(t.errMsg,3e3))).finally((()=>setTimeout((()=>e.disabled=!1),800)))))},getFormData(){const e=this,{options:t}=e;return{...{delivery:e.curDelivery,couponId:e.selectCouponId||0,isUsePoints:e.isUsePoints?1:0,remark:e.remark||""},...N(t.mode,t)}},onVerifyFrom(){const e=this;return!e.hasError||(e.showToast(e.errorMsg,3e3),!1)},showToast(e,t=2e3){this.$refs.uToast.show({title:e,duration:t})}}},[["render",function(p,w,v,S,P,I){const U=c,V=n,$=C,O=k(e("u-switch"),D),z=_,N=y,L=k(e("u-modal"),x),j=k(e("u-icon"),b),F=k(e("u-popup"),T),M=k(e("u-toast"),E);return t(),o(V,{class:"container p-bottom",style:a(p.appThemeStyle)},{default:s((()=>[P.order.goodsList&&P.order.goodsList.length?(t(),o(V,{key:0},{default:s((()=>[P.order.orderType==P.OrderTypeEnum.PHYSICAL.value?(t(),f(m,{key:0},[P.isShowTab?(t(),o(V,{key:0,class:"swiper-tab dis-flex flex-y-center flex-x-around"},{default:s((()=>[l(V,{class:i(["swiper-tab-item",{on:P.curDelivery==P.DeliveryTypeEnum.EXPRESS.value}]),onClick:w[0]||(w[0]=e=>I.handleSwichDelivery(P.DeliveryTypeEnum.EXPRESS.value))},{default:s((()=>[l(U,null,{default:s((()=>[u("快递配送")])),_:1})])),_:1},8,["class"])])),_:1})):d("",!0),P.curDelivery==P.DeliveryTypeEnum.EXPRESS.value?(t(),o(V,{key:1,onClick:I.onSelectAddress,class:"flow-delivery"},{default:s((()=>[l(V,{class:"flow-delivery__detail dis-flex flex-y-center"},{default:s((()=>[l(V,{class:"detail-location dis-flex"},{default:s((()=>[l(U,{class:"iconfont icon-dingwei"})])),_:1}),l(V,{class:"detail-content flex-box"},{default:s((()=>[P.order.address?(t(),f(m,{key:0},[l(V,{class:"detail-content__title dis-flex"},{default:s((()=>[l(U,{class:"f-30"},{default:s((()=>[u(r(P.order.address.name),1)])),_:1}),l(U,{class:"detail-content__title-phone f-28"},{default:s((()=>[u(r(P.order.address.phone),1)])),_:1})])),_:1}),l(V,{class:"address detail-content__describe"},{default:s((()=>[(t(!0),f(m,null,h(P.order.address.region,((e,l)=>(t(),o(U,{class:"region",key:l},{default:s((()=>[u(r(e),1)])),_:2},1024)))),128)),l(U,{class:"detail"},{default:s((()=>[u(r(P.order.address.detail),1)])),_:1})])),_:1})],64)):(t(),o(V,{key:1,class:"detail-content__describe dis-flex"},{default:s((()=>[l(U,{class:"col-6"},{default:s((()=>[u("请选择配送地址")])),_:1})])),_:1}))])),_:1}),l(V,{class:"detail-arrow dis-flex"},{default:s((()=>[l(U,{class:"iconfont icon-arrow-right"})])),_:1})])),_:1})])),_:1},8,["onClick"])):d("",!0)],64)):d("",!0),(t(!0),f(m,null,h(P.order.goodsList,((e,a)=>(t(),o(V,{class:"checkout_list",key:a},{default:s((()=>[l(V,{class:"flow-shopList dis-flex","data-index":"index",onClick:t=>I.onTargetGoods(e.goods_id)},{default:s((()=>[l(V,{class:"flow-list-left"},{default:s((()=>[l($,{mode:"scaleToFill",src:e.goods_image},null,8,["src"])])),_:2},1024),l(V,{class:"flow-list-right flex-box"},{default:s((()=>[l(U,{class:"goods-name twoline-hide"},{default:s((()=>[u(r(e.goods_name),1)])),_:2},1024),l(V,{class:"goods-props clearfix"},{default:s((()=>[(t(!0),f(m,null,h(e.skuInfo.goods_props,((e,a)=>(t(),o(V,{class:"goods-props-item",key:a},{default:s((()=>[l(U,{class:"group-name"},{default:s((()=>[u(r(e.group.name)+": ",1)])),_:2},1024),l(U,null,{default:s((()=>[u(r(e.value.name)+"；",1)])),_:2},1024)])),_:2},1024)))),128))])),_:2},1024),l(V,{class:"flow-list-cont dis-flex flex-x-between flex-y-center"},{default:s((()=>[l(U,{class:"small"},{default:s((()=>[u("×"+r(e.total_num),1)])),_:2},1024),l(U,{class:i(["flow-cont",[e.is_user_grade?"price-delete":""]])},{default:s((()=>[u("￥"+r(e.goods_price),1)])),_:2},1032,["class"])])),_:2},1024),e.is_user_grade?(t(),o(V,{key:0,class:"grade-price"},{default:s((()=>[l(U,null,{default:s((()=>[u("会员折扣价：￥"+r(e.grade_goods_price),1)])),_:2},1024)])),_:2},1024)):d("",!0)])),_:2},1024)])),_:2},1032,["onClick"])])),_:2},1024)))),128)),l(V,{class:"flow-num-box b-f"},{default:s((()=>[l(U,null,{default:s((()=>[u("共"+r(P.order.orderTotalNum)+"件商品",1)])),_:1})])),_:1}),l(V,{class:"flow-all-money b-f m-top20"},{default:s((()=>[l(V,{class:"flow-all-list dis-flex"},{default:s((()=>[l(U,{class:"flex-five"},{default:s((()=>[u("订单总金额：")])),_:1}),l(V,{class:"flex-five t-r"},{default:s((()=>[l(U,{class:"col-m"},{default:s((()=>[u("￥"+r(P.order.orderTotalPrice),1)])),_:1})])),_:1})])),_:1}),p.$checkModule("market-coupon")?(t(),o(V,{key:0,class:"flow-all-list dis-flex"},{default:s((()=>[l(U,{class:"flex-five"},{default:s((()=>[u("优惠券：")])),_:1}),l(V,{class:"flex-five t-r"},{default:s((()=>[P.order.couponList.length>0?(t(),o(V,{key:0,onClick:w[1]||(w[1]=e=>I.handleShowPopup())},{default:s((()=>[P.order.couponId>0?(t(),o(U,{key:0,class:"col-m"},{default:s((()=>[u("-￥"+r(P.order.couponMoney),1)])),_:1})):(t(),o(U,{key:1,class:"col-m"},{default:s((()=>[u("有"+r(P.order.couponList.length)+"张优惠券",1)])),_:1})),l(U,{class:"right-arrow iconfont icon-arrow-right"})])),_:1})):(t(),o(U,{key:1,class:""},{default:s((()=>[u("无优惠券可用")])),_:1}))])),_:1})])),_:1})):d("",!0),p.$checkModule("market-points")&&P.order.isAllowPoints?(t(),o(V,{key:1,class:"points flow-all-list dis-flex flex-y-center"},{default:s((()=>[l(V,{class:"block-left flex-five",onClick:w[2]||(w[2]=e=>I.handleShowPoints())},{default:s((()=>[l(U,{class:"title"},{default:s((()=>[u("可用"+r(P.setting.points_name)+"抵扣：",1)])),_:1}),l(U,{class:"iconfont icon-help"})])),_:1}),l(V,{class:"flex-five dis-flex flex-x-end flex-y-center"},{default:s((()=>[l(U,{class:"points-money col-m"},{default:s((()=>[u("-￥"+r(P.order.pointsMoney),1)])),_:1}),l(O,{modelValue:P.isUsePoints,"onUpdate:modelValue":w[3]||(w[3]=e=>P.isUsePoints=e),size:"42","active-color":p.appTheme.mainBg,onChange:w[4]||(w[4]=e=>I.getOrderData())},null,8,["modelValue","active-color"])])),_:1})])),_:1})):d("",!0),P.curDelivery==P.DeliveryTypeEnum.EXPRESS.value?(t(),o(V,{key:2,class:"dis-flex flow-all-list"},{default:s((()=>[l(U,{class:"flex-five"},{default:s((()=>[u("配送费用：")])),_:1}),l(V,{class:"flex-five t-r"},{default:s((()=>[P.order.address?(t(),o(V,{key:0},{default:s((()=>[P.order.isIntraRegion?(t(),o(U,{key:0,class:"col-m"},{default:s((()=>[u("+￥"+r(P.order.expressPrice),1)])),_:1})):(t(),o(U,{key:1},{default:s((()=>[u("不在配送范围")])),_:1}))])),_:1})):(t(),o(V,{key:1},{default:s((()=>[l(U,{class:"col-7"},{default:s((()=>[u("请先选择配送地址")])),_:1})])),_:1}))])),_:1})])),_:1})):d("",!0)])),_:1}),l(V,{class:"flow-all-money b-f m-top20"},{default:s((()=>[l(V,{class:"ipt-wrapper flow-all-list"},{default:s((()=>[l(z,{class:"input",modelValue:P.remark,"onUpdate:modelValue":w[5]||(w[5]=e=>P.remark=e),placeholder:"选填：买家留言（50字以内）"},null,8,["modelValue"])])),_:1})])),_:1}),l(V,{class:"flow-fixed-footer b-f m-top10"},{default:s((()=>[l(V,{class:"dis-flex chackout-box"},{default:s((()=>[l(V,{class:"chackout-left pl-12"},{default:s((()=>[u("实付款： "),l(U,{class:"col-m"},{default:s((()=>[u("￥"+r(P.order.orderPayPrice),1)])),_:1})])),_:1}),l(V,{class:"chackout-right",onClick:w[6]||(w[6]=e=>I.onSubmitOrder())},{default:s((()=>[l(V,{class:i(["flow-btn f-32",{disabled:P.disabled}])},{default:s((()=>[u("提交订单")])),_:1},8,["class"])])),_:1})])),_:1})])),_:1}),l(L,{modelValue:P.showPoints,"onUpdate:modelValue":w[7]||(w[7]=e=>P.showPoints=e),title:`${P.setting.points_name}说明`},{default:s((()=>[l(N,{class:"points-content","scroll-y":!0},{default:s((()=>[l(U,null,{default:s((()=>[u(r(P.setting.points_describe),1)])),_:1})])),_:1})])),_:1},8,["modelValue","title"]),l(F,{modelValue:P.showPopup,"onUpdate:modelValue":w[9]||(w[9]=e=>P.showPopup=e),mode:"bottom"},{default:s((()=>[l(V,{class:"popup__coupon"},{default:s((()=>[l(V,{class:"coupon__title f-30"},{default:s((()=>[u("选择优惠券")])),_:1}),l(N,{"scroll-y":!0,style:{height:"650rpx"}},{default:s((()=>[l(V,{class:"coupon-list"},{default:s((()=>[(t(!0),f(m,null,h(P.order.couponList,((e,a)=>(t(),o(V,{class:"coupon-item",key:a},{default:s((()=>[l(V,{class:i(["item-wrapper",[e.state.value?"":"disable"]]),onClick:e=>I.handleSelectCoupon(a)},{default:s((()=>[l(V,{class:"coupon-tag"},{default:s((()=>[l(U,null,{default:s((()=>[u(r(P.CouponTypeEnum[e.coupon_type].name),1)])),_:2},1024)])),_:2},1024),l(V,{class:"coupon-left"},{default:s((()=>[l(V,{class:"coupon-reduce"},{default:s((()=>[e.coupon_type==P.CouponTypeEnum.FULL_DISCOUNT.value?(t(),f(m,{key:0},[l(V,{class:"coupon-reduce-unit"},{default:s((()=>[l(U,null,{default:s((()=>[u("￥")])),_:1})])),_:1}),l(V,{class:"coupon-reduce-amount"},{default:s((()=>[l(U,{class:"value"},{default:s((()=>[u(r(e.reduce_price),1)])),_:2},1024)])),_:2},1024)],64)):d("",!0),e.coupon_type==P.CouponTypeEnum.DISCOUNT.value?(t(),o(V,{key:1,class:"coupon-reduce-amount"},{default:s((()=>[l(U,{class:"value"},{default:s((()=>[u(r(e.discount)+"折",1)])),_:2},1024)])),_:2},1024)):d("",!0)])),_:2},1024),l(U,{class:"coupon-hint"},{default:s((()=>[u("满"+r(e.min_price)+"元可用",1)])),_:2},1024)])),_:2},1024),l(V,{class:"coupon-content"},{default:s((()=>[l(V,{class:"coupon-name"},{default:s((()=>[u(r(e.name),1)])),_:2},1024),l(V,{class:"coupon-middle"},{default:s((()=>[l(V,{class:"coupon-expire"},{default:s((()=>[e.expire_type==P.CouponTypeEnum.FULL_DISCOUNT.value?(t(),o(U,{key:0},{default:s((()=>[u("领取后"+r(e.expire_day)+"天内有效",1)])),_:2},1024)):d("",!0),e.expire_type==P.CouponTypeEnum.DISCOUNT.value?(t(),o(U,{key:1},{default:s((()=>[e.start_time===e.end_time?(t(),f(m,{key:0},[u(r(e.start_time)+" 当天有效",1)],64)):(t(),f(m,{key:1},[u(r(e.start_time)+"~"+r(e.end_time),1)],64))])),_:2},1024)):d("",!0)])),_:2},1024)])),_:2},1024),e.describe?(t(),o(V,{key:0,class:"coupon-expand",onClick:g((e=>I.handleDescribe(a)),["stop"])},{default:s((()=>[l(U,null,{default:s((()=>[u("使用说明")])),_:1}),l(U,{class:i(["coupon-expand-arrow iconfont icon-arrow-down",[e.expand?"expand":""]])},null,8,["class"])])),_:2},1032,["onClick"])):d("",!0)])),_:2},1024),l(V,{class:"coupon-right"},{default:s((()=>[l(V,{class:i(["my-radio",{checked:P.selectCouponId==e.user_coupon_id}])},{default:s((()=>[l(j,{name:"checkbox-mark",size:20})])),_:2},1032,["class"])])),_:2},1024)])),_:2},1032,["class","onClick"]),l(V,{class:i([[e.expand?"expand":""],"coupon-expand-rules"])},{default:s((()=>[l(V,{class:"coupon-expand-rules-content"},{default:s((()=>[l(V,{class:"pre"},{default:s((()=>[u(r(e.describe),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["class"])])),_:2},1024)))),128))])),_:1})])),_:1}),l(V,{class:"coupon__do_not"},{default:s((()=>[l(V,{class:"control",onClick:w[8]||(w[8]=e=>I.handleNotUseCoupon())},{default:s((()=>[l(U,{class:"f-26"},{default:s((()=>[u("不使用优惠券")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})):d("",!0),l(M,{ref:"uToast"},null,512)])),_:1},8,["style"])}],["__scopeId","data-v-2f0a5f74"]]);export{L as default};
