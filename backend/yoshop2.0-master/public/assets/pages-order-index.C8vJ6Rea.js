import{_ as e}from"./u-tabs.OeK_Loi0.js";import{m as t,p as a,q as s,c as o,w as l,n,i,o as r,a as u,b as d,d as c,F as m,f as p,t as _,e as f,l as h,g as y}from"./index-BR_epvkd.js";import{r as g}from"./uni-app.es.Cu0rwAi-.js";import{M as v,_ as E}from"./mescroll-mixins.nOOeBu6g.js";import{a as C,b as T,D as b,c as k,P as S,R}from"./OrderType.CT20E9Ho.js";import{P as D,C as P}from"./Client.Dtcsx8M3.js";import{l as I,c as L,r as x}from"./order.BWyy-hpt.js";import{_ as O}from"./_plugin-vue_export-helper.BCo6x5W8.js";const w=[{name:"全部",value:"all"},{name:"待支付",value:"payment"},{name:"待发货",value:"delivery"},{name:"待收货",value:"received"},{name:"待评价",value:"comment"}];const M=O({mixins:[v],data:()=>({OrderSourceEnum:C,DeliveryStatusEnum:T,DeliveryTypeEnum:b,OrderStatusEnum:k,PayStatusEnum:S,ReceiptStatusEnum:R,PayMethodEnum:D,options:{dataType:"all",orderSource:null},tabs:w,curTab:0,list:t(),upOption:{auto:!0,page:{size:15},noMoreSize:4,empty:{tip:"亲，暂无订单记录"}},canReset:!1}),onLoad(e){this.options={...this.options,...e},this.initCurTab(),uni.$on("syncRefresh",(e=>{this.canReset=e}))},onUnload(){},onShow(){this.canReset&&this.onRefreshList(),this.canReset=!1},onUnload(){uni.$off("syncRefresh")},methods:{initCurTab(){const{options:e}=this;if(e.dataType){const t=this.tabs.findIndex((t=>t.value==e.dataType));this.curTab=t>-1?t:0}},upCallback(e){const t=this;t.getOrderList(e.num).then((e=>{const a=e.data.length,s=e.total;t.mescroll.endBySize(a,s)})).catch((()=>t.mescroll.endErr()))},getOrderList(e=1){const t=this;return new Promise(((s,o)=>{I({dataType:t.getTabValue(),orderSource:t.options.orderSource,page:e},{load:!1}).then((o=>{const l=t.initList(o.data.list);t.list.data=a(l,t.list,e),s(l)}))}))},initList:e=>(e.data.forEach((e=>{e.total_num=0,e.goods.forEach((t=>{e.total_num+=t.total_num}))})),e),getTabValue(){return this.tabs[this.curTab].value},onChangeTab(e){this.curTab=e,this.onRefreshList()},onRefreshList(){this.list=t(),setTimeout((()=>{this.mescroll.resetUpScroll()}),120)},onCancel(e){const t=this;uni.showModal({title:"友情提示",content:"确认要取消该订单吗？",success(a){a.confirm&&L(e).then((e=>{t.$toast(e.message),t.onRefreshList()}))}})},async onReceipt(e){const t=this,a=t.list.data[e];t.platform===P.MP_WEIXIN.value&&a.sync_weixin_shipping&&a.pay_method===D.WECHAT.value&&a.platform===P.MP_WEIXIN.value||t.receiptModal(a.order_id)},receiptModal(e){const t=this;uni.showModal({title:"友情提示",content:"确认收到商品了吗？",success(a){a.confirm&&t.receiptEvent(e)}})},receiptEvent(e){const t=this;x(e).then((e=>{t.$success(e.message),t.onRefreshList()}))},onPay(e){this.$navTo("pages/checkout/cashier/index",{orderId:e})},handleTargetDetail(e){this.$navTo("pages/order/detail",{orderId:e})},handleTargetComment(e){this.$navTo("pages/order/comment/index",{orderId:e})}}},[["render",function(t,a,v,C,T,b){const k=g(s("u-tabs"),e),S=h,R=i,D=y,P=g(s("mescroll-body"),E);return r(),o(R,{class:"container",style:n(t.appThemeStyle)},{default:l((()=>[u(P,{ref:"mescrollRef",sticky:!0,onInit:t.mescrollInit,down:{native:!0},onDown:t.downCallback,up:T.upOption,onUp:b.upCallback},{default:l((()=>[u(k,{list:T.tabs,"is-scroll":!1,modelValue:T.curTab,"onUpdate:modelValue":a[0]||(a[0]=e=>T.curTab=e),"active-color":t.appTheme.mainBg,duration:.2,onChange:b.onChangeTab},null,8,["list","modelValue","active-color","onChange"]),u(R,{class:"order-list"},{default:l((()=>[(r(!0),d(m,null,c(T.list.data,((e,t)=>(r(),o(R,{class:"order-item",key:t},{default:l((()=>[u(R,{class:"item-top"},{default:l((()=>[u(R,{class:"item-top-left"},{default:l((()=>[u(S,{class:"order-time"},{default:l((()=>[p(_(e.create_time),1)])),_:2},1024)])),_:2},1024),u(R,{class:"item-top-right"},{default:l((()=>[u(S,{class:"state-text"},{default:l((()=>[p(_(e.state_text),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),u(R,{class:"goods-list",onClick:t=>b.handleTargetDetail(e.order_id)},{default:l((()=>[(r(!0),d(m,null,c(e.goods,((e,t)=>(r(),o(R,{class:"goods-item",key:t},{default:l((()=>[u(R,{class:"goods-image"},{default:l((()=>[u(D,{class:"image",src:e.goods_image,mode:"scaleToFill"},null,8,["src"])])),_:2},1024),u(R,{class:"goods-content"},{default:l((()=>[u(R,{class:"goods-title"},{default:l((()=>[u(S,{class:"twoline-hide"},{default:l((()=>[p(_(e.goods_name),1)])),_:2},1024)])),_:2},1024),u(R,{class:"goods-props clearfix"},{default:l((()=>[(r(!0),d(m,null,c(e.goods_props,((e,t)=>(r(),o(R,{class:"goods-props-item",key:t},{default:l((()=>[u(S,null,{default:l((()=>[p(_(e.value.name),1)])),_:2},1024)])),_:2},1024)))),128))])),_:2},1024)])),_:2},1024),u(R,{class:"goods-trade"},{default:l((()=>[u(R,{class:"goods-price"},{default:l((()=>[u(S,{class:"unit"},{default:l((()=>[p("￥")])),_:1}),u(S,{class:"value"},{default:l((()=>[p(_(e.is_user_grade?e.grade_goods_price:e.goods_price),1)])),_:2},1024)])),_:2},1024),u(R,{class:"goods-num"},{default:l((()=>[u(S,null,{default:l((()=>[p("×"+_(e.total_num),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:2},1032,["onClick"]),u(R,{class:"order-total"},{default:l((()=>[u(S,null,{default:l((()=>[p("共"+_(e.total_num)+"件商品，总金额",1)])),_:2},1024),u(S,{class:"unit"},{default:l((()=>[p("￥")])),_:1}),u(S,{class:"money"},{default:l((()=>[p(_(e.pay_price),1)])),_:2},1024)])),_:2},1024),e.order_status!=T.OrderStatusEnum.CANCELLED.value?(r(),o(R,{key:0,class:"order-handle"},{default:l((()=>[u(R,{class:"btn-group clearfix"},{default:l((()=>[e.pay_status==T.PayStatusEnum.PENDING.value?(r(),o(R,{key:0,class:"btn-item",onClick:t=>b.onCancel(e.order_id)},{default:l((()=>[p("取消")])),_:2},1032,["onClick"])):f("",!0),e.order_status!=T.OrderStatusEnum.APPLY_CANCEL.value?(r(),d(m,{key:1},[e.pay_status==T.PayStatusEnum.SUCCESS.value&&e.delivery_status==T.DeliveryStatusEnum.NOT_DELIVERED.value?(r(),o(R,{key:0,class:"btn-item",onClick:t=>b.onCancel(e.order_id)},{default:l((()=>[p("申请取消")])),_:2},1032,["onClick"])):f("",!0)],64)):(r(),o(R,{key:2,class:"f-28 col-8"},{default:l((()=>[p("取消申请中")])),_:1})),e.pay_status==T.PayStatusEnum.PENDING.value?(r(),o(R,{key:3,class:"btn-item active",onClick:t=>b.onPay(e.order_id)},{default:l((()=>[p("去支付")])),_:2},1032,["onClick"])):f("",!0),e.delivery_status==T.DeliveryStatusEnum.DELIVERED.value&&e.receipt_status==T.ReceiptStatusEnum.NOT_RECEIVED.value?(r(),o(R,{key:4,class:"btn-item active",onClick:e=>b.onReceipt(t)},{default:l((()=>[p("确认收货")])),_:2},1032,["onClick"])):f("",!0),e.order_status==T.OrderStatusEnum.COMPLETED.value&&0==e.is_comment?(r(),o(R,{key:5,class:"btn-item",onClick:t=>b.handleTargetComment(e.order_id)},{default:l((()=>[p("评价")])),_:2},1032,["onClick"])):f("",!0)])),_:2},1024)])),_:2},1024)):f("",!0)])),_:2},1024)))),128))])),_:1})])),_:1},8,["onInit","onDown","up","onUp"])])),_:1},8,["style"])}],["__scopeId","data-v-d4e12390"]]);export{M as default};
